#!/usr/bin/env bash
set -euo pipefail
IFS=$'\n\t'
PATH=$(npm bin):$PATH

# Build js index
target=./src/components.js
files=$( find src/components -name '*.js' | sort )

echo "// Generated by $0" > $target
for f in $files
do
    base=$( basename "${f%.js}" )
    echo "import $base from './components/$base';" >> $target
done

echo "" >> $target
echo "export default {" >> $target

for f in $files
do
    base=$( basename "${f%.js}" )
    echo "    $base: $base," >> $target
done

echo "};" >> $target

# Build sass index
target=./src/styles/bundle.scss

echo "// Generated by $0" > $target
echo "@import './normalize.scss';" >> $target
echo "@import './colors.scss';" >> $target
echo "@import './responsive.scss';" >> $target

echo "" >> $target

for f in $( find src -name '*.scss' -not -path 'src/styles/*.scss' | sort )
do
    import=$( echo "$f" | sed s/^src\\//..\\// )
    echo "@import '${import}';" >> $target
done
